// ÂΩìDOMÂÜÖÂÆπÂä†ËΩΩÂÆåÊàêÂêéÊâßË°å
document.addEventListener('DOMContentLoaded', function() {
    // Ëé∑ÂèñFAQÊªöÂä®ÂÆπÂô®ÂíåÂÜÖÂÆπÂÖÉÁ¥†
    const scrollContainer = document.querySelector('.faq-scroll-container');
    const faqContent = document.querySelector('.faq-content');
    
    // Â¶ÇÊûúÂÖÉÁ¥†‰∏çÂ≠òÂú®ÂàôÈÄÄÂá∫
    if (!scrollContainer || !faqContent) return;

    // ÂàùÂßãÂåñÂèòÈáè
    let isDown = false; // ÊòØÂê¶Ê≠£Âú®ÊãñÂä®
    let startX; // ÂºÄÂßãÊãñÂä®ÁöÑXÂùêÊ†á
    let scrollLeft; // ÂºÄÂßãÊãñÂä®Êó∂ÁöÑÊªöÂä®‰ΩçÁΩÆ
    let autoScrollInterval = null; // Ëá™Âä®ÊªöÂä®ÁöÑÂÆöÊó∂Âô®
    let isAutoScrolling = true; // ÊòØÂê¶ÂêØÁî®Ëá™Âä®ÊªöÂä®
    const scrollSpeed = 1; // ÊªöÂä®ÈÄüÂ∫¶

    // Ëá™Âä®ÊªöÂä®ÂäüËÉΩ
    function startAutoScroll() {
        // Â¶ÇÊûú‰∏çÂú®Ëá™Âä®ÊªöÂä®Áä∂ÊÄÅÊàñÂ∑≤ÊúâÂÆöÊó∂Âô®ÂàôËøîÂõû
        if (!isAutoScrolling || autoScrollInterval) return;
        
        // ËÆæÁΩÆÂÆöÊó∂Âô®ÂÆûÁé∞Ëá™Âä®ÊªöÂä®
        autoScrollInterval = setInterval(() => {
            if (!isDown) {
                scrollContainer.scrollLeft += scrollSpeed;
                
                // ÂΩìÊªöÂä®Âà∞Êú´Â∞æÊó∂ÈáçÁΩÆÂà∞ÂºÄÂßã‰ΩçÁΩÆ
                if (scrollContainer.scrollLeft >= (faqContent.scrollWidth - scrollContainer.clientWidth)) {
                    scrollContainer.scrollLeft = 0;
                }
            }
        }, 20);
    }

    // ÂÅúÊ≠¢Ëá™Âä®ÊªöÂä®
    function stopAutoScroll() {
        if (autoScrollInterval) {
            clearInterval(autoScrollInterval);
            autoScrollInterval = null;
        }
    }

    // Èº†Ê†áÊåâ‰∏ã‰∫ã‰ª∂Â§ÑÁêÜ
    scrollContainer.addEventListener('mousedown', (e) => {
        isDown = true;
        isAutoScrolling = false;
        scrollContainer.style.cursor = 'grabbing'; // ÊîπÂèòÈº†Ê†áÊ†∑Âºè
        startX = e.pageX - scrollContainer.offsetLeft;
        scrollLeft = scrollContainer.scrollLeft;
        stopAutoScroll();
    });

    // Èº†Ê†áÊùæÂºÄ‰∫ã‰ª∂Â§ÑÁêÜ
    scrollContainer.addEventListener('mouseup', () => {
        isDown = false;
        scrollContainer.style.cursor = 'grab';
        // 2ÁßíÂêéÊÅ¢Â§çËá™Âä®ÊªöÂä®
        setTimeout(() => {
            isAutoScrolling = true;
            startAutoScroll();
        }, 2000);
    });

    // Èº†Ê†áÁßªÂá∫‰∫ã‰ª∂Â§ÑÁêÜ
    scrollContainer.addEventListener('mouseleave', () => {
        isDown = false;
        scrollContainer.style.cursor = 'grab';
        // 2ÁßíÂêéÊÅ¢Â§çËá™Âä®ÊªöÂä®
        setTimeout(() => {
            isAutoScrolling = true;
            startAutoScroll();
        }, 2000);
    });

    // Èº†Ê†áÁßªÂä®‰∫ã‰ª∂Â§ÑÁêÜ
    scrollContainer.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - scrollContainer.offsetLeft;
        const walk = (x - startX) * 2; // ËÆ°ÁÆóÊãñÂä®Ë∑ùÁ¶ª
        scrollContainer.scrollLeft = scrollLeft - walk;
    });

    // Ëß¶Êë∏‰∫ã‰ª∂ÊîØÊåÅ - Ëß¶Êë∏ÂºÄÂßã
    scrollContainer.addEventListener('touchstart', (e) => {
        isAutoScrolling = false;
        stopAutoScroll();
        isDown = true;
        startX = e.touches[0].pageX - scrollContainer.offsetLeft;
        scrollLeft = scrollContainer.scrollLeft;
    });

    // Ëß¶Êë∏‰∫ã‰ª∂ÊîØÊåÅ - Ëß¶Êë∏ÁªìÊùü
    scrollContainer.addEventListener('touchend', () => {
        isDown = false;
        // 2ÁßíÂêéÊÅ¢Â§çËá™Âä®ÊªöÂä®
        setTimeout(() => {
            isAutoScrolling = true;
            startAutoScroll();
        }, 2000);
    });

    // Ëß¶Êë∏‰∫ã‰ª∂ÊîØÊåÅ - Ëß¶Êë∏ÁßªÂä®
    scrollContainer.addEventListener('touchmove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.touches[0].pageX - scrollContainer.offsetLeft;
        const walk = (x - startX) * 2;
        scrollContainer.scrollLeft = scrollLeft - walk;
    });

    // ÂêØÂä®Ëá™Âä®ÊªöÂä®
    startAutoScroll();

    // FAQ Modal functionality
    const viewMoreButtons = document.querySelectorAll('.view-more');
    const closeBtn = document.getElementById('closeBtn');
    const overlay = document.getElementById('overlay');
    const modal = document.getElementById('modal');

    // ÂÆö‰πâÂºπÁ™óÂÜÖÂÆπÊò†Â∞ÑË°®
    const contentMap = {
        FAQ1: {
            title: "What is BeamCat used for?",
            content: `
                <div class="modal-section">
                    <p>BeamCat is an intelligent interaction tool based on gesture or eye control. It allows users to perform actions such as clicking, scrolling, and zooming without touching the mouse. This innovative technology is particularly useful for:</p>
                    <ul>
                        <li>Designers who need precise control while working</li>
                        <li>Remote users who want hands-free operation</li>
                        <li>Accessibility scenarios where traditional input methods are challenging</li>
                        <li>Smart home control and automation</li>
                    </ul>
                </div>
            `
        },
        FAQ2: {
            title: "What devices does BeamCat support?",
            content: `
                <div class="modal-section">
                    <p>Currently, BeamCat only supports use on Windows. In the future, we plan to expand support to:</p>
                    <ul>
                        <li>Smartphones and tablets</li>
                        <li>Smart TVs and displays</li>
                        <li>Air conditioners and climate control systems</li>
                        <li>Washing machines and other home appliances</li>
                        <li>Smart speakers and audio systems</li>
                        <li>Other smart home devices</li>
                    </ul>
                    <p>Our goal is to make BeamCat available across all major platforms and devices.</p>
                </div>
            `
        },
        FAQ3: {
            title: "How do I activate BeamCat's Golden Zone feature?",
            content: `
                <div class="modal-section">
                    <p>Click the üéØ icon at the center of the circular menu to enable the "Golden Zone" feature. This mode offers:</p>
                    <ul>
                        <li>Lower sensitivity for precise control</li>
                        <li>Ideal for clicking small buttons</li>
                        <li>Perfect for detailed work and fine adjustments</li>
                        <li>Enhanced accuracy for photo editing and design work</li>
                    </ul>
                </div>
            `
        },
        FAQ4: {
            title: "How do I pause BeamCat's tracking feature?",
            content: `
                <div class="modal-section">
                    <p>You can pause BeamCat's tracking in several ways:</p>
                    <ul>
                        <li>Press Ctrl + CapsLock on the keyboard</li>
                        <li>Click the ‚èØÔ∏è Tracking icon in the circular menu</li>
                        <li>When paused, the system will stop responding to head movements</li>
                        <li>This is useful when you need to take a break or make adjustments</li>
                    </ul>
                </div>
            `
        },
        FAQ5: {
            title: "What should I do if BeamCat feels inaccurate during use?",
            content: `
                <div class="modal-section">
                    <p>If you experience accuracy issues, try these solutions:</p>
                    <ul>
                        <li>Check the lighting conditions in your environment</li>
                        <li>Ensure the camera is unobstructed</li>
                        <li>Maintain a comfortable distance from the screen</li>
                        <li>Adjust the sensitivity settings in the control panel</li>
                        <li>Calibrate the system using the calibration tool</li>
                    </ul>
                </div>
            `
        },
        FAQ6: {
            title: "Can BeamCat be used without an internet connection?",
            content: `
                <div class="modal-section">
                    <p>Yes! BeamCat is designed to work completely offline:</p>
                    <ul>
                        <li>All tracking and gesture recognition are processed locally</li>
                        <li>No internet connection required after installation</li>
                        <li>Your data remains secure on your device</li>
                        <li>Perfect for use in any environment</li>
                    </ul>
                </div>
            `
        },
        FAQ7: {
            title: "Does BeamCat support customizable sensitivity and gesture settings?",
            content: `
                <div class="modal-section">
                    <p>Yes, BeamCat offers extensive customization options:</p>
                    <ul>
                        <li>Adjustable sensitivity settings</li>
                        <li>Customizable gesture configurations (coming soon)</li>
                        <li>Personalized tracking speed and range</li>
                        <li>Save and load different profiles</li>
                    </ul>
                </div>
            `
        }
    };

    // ‰∏∫ÊØè‰∏™ÊåâÈíÆÊ∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
    viewMoreButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault(); // Èò≤Ê≠¢ÈªòËÆ§Ë°å‰∏∫
            console.log('Button clicked'); // Ë∞ÉËØïÊó•Âøó
            
            const faqId = this.getAttribute('data-faq');
            console.log('FAQ ID:', faqId); // Ë∞ÉËØïÊó•Âøó
            
            if (!contentMap[faqId]) {
                console.error('No content found for FAQ ID:', faqId);
                return;
            }
            
            const { title, content } = contentMap[faqId];
            console.log('Title:', title); // Ë∞ÉËØïÊó•Âøó
            
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            if (!modalTitle || !modalContent) {
                console.error('Modal elements not found');
                return;
            }
            
            modalTitle.innerText = title;
            modalContent.innerHTML = content;
            
            overlay.style.display = 'block';
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            console.log('Modal should be visible now'); // Ë∞ÉËØïÊó•Âøó
        });
    });

    // ÂÖ≥Èó≠ÊåâÈíÆ‰∫ã‰ª∂
    closeBtn.addEventListener('click', closeModal);

    // ÁÇπÂáªÈÅÆÁΩ©Â±ÇÂÖ≥Èó≠
    overlay.addEventListener('click', function(e) {
        if (e.target === overlay) {
            closeModal();
        }
    });

    // ESCÈîÆÂÖ≥Èó≠
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModal();
        }
    });

    // ÂÖ≥Èó≠ÂºπÁ™óÂáΩÊï∞
    function closeModal() {
        overlay.style.display = 'none';
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }

    // Èù¢ÈÉ®ËØÜÂà´ÂõæÊ†áÁÇπÂáª‰∫ã‰ª∂
    const fidIcon = document.getElementById('fid-icon');
    if (fidIcon) {
        fidIcon.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'face-login.html';
        });
    }
});

// ÊâìÂºÄËßÜÈ¢ëÊ®°ÊÄÅÊ°Ü
function openVideoModal() {
    const modal = document.getElementById('videoModal');
    const videoFrame = document.getElementById('videoFrame');
    // ËÆæÁΩÆËßÜÈ¢ëURLÔºàÈúÄË¶ÅÊõøÊç¢ÊàêÂÆûÈôÖÁöÑËßÜÈ¢ëURLÔºâ
    videoFrame.src = 'https://www.youtube.com/embed/your-video-id';
    modal.style.display = 'block';
    
    // Ê∑ªÂä†ESCÈîÆÂÖ≥Èó≠ÂäüËÉΩ
    document.addEventListener('keydown', handleEscKey);
}

// ÂÖ≥Èó≠ËßÜÈ¢ëÊ®°ÊÄÅÊ°Ü
function closeVideoModal() {
    const modal = document.getElementById('videoModal');
    const videoFrame = document.getElementById('videoFrame');
    modal.style.display = 'none';
    // ÂÅúÊ≠¢ËßÜÈ¢ëÊí≠Êîæ
    videoFrame.src = '';
    
    // ÁßªÈô§ESCÈîÆ‰∫ã‰ª∂ÁõëÂê¨
    document.removeEventListener('keydown', handleEscKey);
}

// Â§ÑÁêÜESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
function handleEscKey(event) {
    if (event.key === 'Escape') {
        closeVideoModal();
    }
}

// ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
window.onclick = function(event) {
    const videoModal = document.getElementById('videoModal');
    const faqModal = document.getElementById('modal');
    if (event.target === videoModal) {
        closeVideoModal();
    } else if (event.target === faqModal) {
        closeModal();
    }
}

function togglePasswordVisibility() {
    const passwordInput = document.getElementById('password');
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
    } else {
        passwordInput.type = 'password';
    }
}